<!DOCTYPE html>
<html lang="zh">
<body>
    <h1>ğŸ‘¥ å°ç»„æˆå‘˜ç®¡ç† (æç®€ç‰ˆ)</h1>
    
    <input type="text" id="nameInput" placeholder="è¾“å…¥æˆå‘˜å§“å">
    <button onclick="addMember()">ç‚¹å‡»æ·»åŠ </button>
    
    <hr>
    <div id="status">æ­£åœ¨åŒæ­¥äº‘ç«¯...</div>
    <ul id="memberList"></ul>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://klsvprpkqgqnfhkiaehf.supabase.co'
        const SUPABASE_KEY = 'sb_publishable_yAaCFMoeNHK6LEtLuKe8og_0N19SL2i' // å¡«å…¥ä½ ä¹‹å‰çš„ Key
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY)

        // 1. è·å–å¹¶æ˜¾ç¤ºæˆå‘˜åˆ—è¡¨
        async function refreshList() {
            const { data, error } = await supabaseClient.from('login').select('*')
            if (error) {
                document.getElementById('status').innerText = 'è¯»å–å¤±è´¥: ' + error.message
                return
            }
            const listHtml = data.map(m => `<li>${m.name}</li>`).join('')
            document.getElementById('memberList').innerHTML = listHtml
            document.getElementById('status').innerText = `å½“å‰å…±æœ‰ ${data.length} åæˆå‘˜`
        }

        // 2. å¾€æ•°æ®åº“æ·»åŠ æˆå‘˜
        async function addMember() {
            const name = document.getElementById('nameInput').value
            if (!name) return alert('è¯·è¾“å…¥åå­—')

            const { error } = await supabaseClient
                .from('members')
                .insert([{ name: name }]) // æ³¨æ„ï¼šç¡®ä¿ä½ çš„è¡¨é‡Œæœ‰ name è¿™ä¸€åˆ—

            if (error) {
                alert('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¼€å¯äº† RLS å†™å…¥æƒé™')
                console.error(error)
            } else {
                document.getElementById('nameInput').value = ''
                refreshList() // æ·»åŠ æˆåŠŸååˆ·æ–°åˆ—è¡¨
            }
        }

        refreshList() // é¡µé¢åŠ è½½æ—¶å…ˆè¯»å–ä¸€æ¬¡
    </script>
</body>
</html>